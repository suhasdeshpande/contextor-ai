<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Management Problem Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 40px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: #4ec9b0;
            margin-bottom: 30px;
            text-align: center;
            font-size: 24px;
        }

        .section {
            margin-bottom: 40px;
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f48771;
        }

        .section.success {
            border-left-color: #4ec9b0;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .section.failure .section-title {
            color: #f48771;
        }

        .section.success .section-title {
            color: #4ec9b0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #3e3e42;
        }

        th {
            background: #2d2d30;
            color: #cccccc;
            font-weight: bold;
        }

        .step-row {
            opacity: 0;
            animation: fadeIn 0.3s ease-in forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .status-ok {
            color: #4ec9b0;
        }

        .status-warning {
            color: #dcdcaa;
        }

        .status-failed {
            color: #f48771;
        }

        .strategy {
            color: #569cd6;
            font-weight: bold;
        }

        .token-bar {
            height: 20px;
            background: #3e3e42;
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
            position: relative;
        }

        .token-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ec9b0, #569cd6);
            transition: width 0.5s ease-out;
            border-radius: 4px;
        }

        .token-fill.warning {
            background: linear-gradient(90deg, #dcdcaa, #ce9178);
        }

        .token-fill.danger {
            background: linear-gradient(90deg, #f48771, #ce9178);
        }

        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #2d2d30;
            border-radius: 8px;
        }

        .summary h2 {
            color: #4ec9b0;
            margin-bottom: 15px;
        }

        .summary ul {
            list-style: none;
            padding-left: 0;
        }

        .summary li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .summary li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #569cd6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</h1>
        <h1>Context Management Problem Visualization</h1>
        <h1>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</h1>

        <div class="section failure" id="without-cm">
            <div class="section-title">âŒ WITHOUT Context Management</div>
            <table>
                <thead>
                    <tr>
                        <th>Step</th>
                        <th>Tokens</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="without-cm-body">
                </tbody>
            </table>
        </div>

        <div class="section success" id="with-cm">
            <div class="section-title">âœ… WITH Context Management</div>
            <table>
                <thead>
                    <tr>
                        <th>Step</th>
                        <th>Tokens</th>
                        <th>Strategy Applied</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="with-cm-body">
                </tbody>
            </table>
        </div>

        <div class="summary">
            <h2>ğŸ“Š Key Differences</h2>
            <ul>
                <li><strong>âŒ Without CM:</strong> Tokens grow unbounded â†’ failure at step ~15-20</li>
                <li><strong>âœ… With CM:</strong> Strategies keep tokens controlled â†’ completes all steps</li>
            </ul>
            <h2 style="margin-top: 20px;">ğŸ’¡ Context Management Strategies</h2>
            <ul>
                <li><strong>ğŸ” Filter</strong> (30k+ tokens): Truncates messages</li>
                <li><strong>ğŸ“¦ Compact</strong> (40k+ tokens): Replaces large outputs with references</li>
                <li><strong>ğŸ“ Summarize</strong> (50k+ tokens, every 5 steps): Condenses old messages</li>
                <li><strong>ğŸ’¾ Offload</strong> (60k+ tokens, after 5 steps): Moves to external storage</li>
            </ul>
        </div>
    </div>

    <script>
        function simulateWithoutCM(steps) {
            const tbody = document.getElementById('without-cm-body');
            let tokens = 1000;

            for (let i = 1; i <= steps; i++) {
                setTimeout(() => {
                    tokens += Math.floor(Math.random() * 2000) + 1000;
                    const status = tokens > 100000 ?
                        '<span class="status-failed">âŒ FAILED (limit exceeded)</span>' :
                        tokens > 80000 ?
                        '<span class="status-warning">âš ï¸ WARNING (approaching limit)</span>' :
                        '<span class="status-ok">âœ… OK</span>';

                    const row = document.createElement('tr');
                    row.className = 'step-row';
                    row.style.animationDelay = '0s';
                    row.innerHTML = `
                        <td>${i}</td>
                        <td>${tokens.toLocaleString()}</td>
                        <td>${status}</td>
                    `;
                    tbody.appendChild(row);

                    if (tokens > 100000) {
                        const failRow = document.createElement('tr');
                        failRow.innerHTML = `
                            <td colspan="3" style="color: #f48771; padding-top: 10px;">
                                ğŸ’¥ Agent failed at step ${i} - token limit exceeded!
                            </td>
                        `;
                        tbody.appendChild(failRow);
                    }
                }, i * 200);
            }
        }

        function simulateWithCM(steps) {
            const tbody = document.getElementById('with-cm-body');
            let tokens = 1000;

            setTimeout(() => {
                for (let i = 1; i <= steps; i++) {
                    setTimeout(() => {
                        tokens += Math.floor(Math.random() * 2000) + 1000;

                        let strategy = '';
                        let reduction = 0;

                        if (tokens > 60000 && i >= 5) {
                            reduction = Math.floor(tokens * 0.85);
                            tokens = reduction;
                            strategy = '<span class="strategy">ğŸ’¾ OFFLOAD</span>';
                        } else if (tokens > 50000 && i % 5 === 0) {
                            reduction = Math.floor(tokens * 0.75);
                            tokens = reduction;
                            strategy = '<span class="strategy">ğŸ“ SUMMARIZE</span>';
                        } else if (tokens > 40000 && i >= 3) {
                            reduction = Math.floor(tokens * 0.60);
                            tokens = reduction;
                            strategy = '<span class="strategy">ğŸ“¦ COMPACT</span>';
                        } else if (tokens > 30000) {
                            reduction = Math.floor(tokens * 0.75);
                            tokens = reduction;
                            strategy = '<span class="strategy">ğŸ” FILTER</span>';
                        } else {
                            strategy = '-';
                        }

                        const status = tokens > 100000 ?
                            '<span class="status-failed">âŒ FAILED</span>' :
                            tokens > 80000 ?
                            '<span class="status-warning">âš ï¸ WARNING</span>' :
                            '<span class="status-ok">âœ… OK</span>';

                        const row = document.createElement('tr');
                        row.className = 'step-row';
                        row.style.animationDelay = '0s';
                        row.innerHTML = `
                            <td>${i}</td>
                            <td>${tokens.toLocaleString()}</td>
                            <td>${strategy}</td>
                            <td>${status}</td>
                        `;
                        tbody.appendChild(row);

                        if (i === steps) {
                            const successRow = document.createElement('tr');
                            successRow.innerHTML = `
                                <td colspan="4" style="color: #4ec9b0; padding-top: 10px; font-weight: bold;">
                                    ğŸ‰ Agent completed all ${steps} steps successfully!
                                </td>
                            `;
                            tbody.appendChild(successRow);
                        }
                    }, (steps * 200) + (i * 200));
                }
            }, 5000);
        }

        // Start simulations
        simulateWithoutCM(20);
        simulateWithCM(20);
    </script>
</body>
</html>

